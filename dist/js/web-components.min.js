function getLookupLoader(){return $("<i>").addClass("fa fa-spinner fa-spin")}function getModal(){var modal=$("<div tabindex='-1' role='dialog'>").addClass("modal fade"),dialog=$("<div>").addClass("modal-dialog"),content=$("<div>").addClass("modal-content"),modalHeader=$("<div>").addClass("modal-header bg-primary"),modalBody=$("<div>").addClass("modal-body"),closeButton=$("<button type='button' class='close' data-dismiss='modal' aria-label='Close'>");return closeButton.html("<span aria-hidden='true'>&times;</span>"),dialog.appendTo(modal),content.appendTo(dialog),modalHeader.appendTo(content),modalBody.appendTo(content),closeButton.appendTo(modalHeader),$("<h4>").addClass("modal-title").html("{{label}}").appendTo(modalHeader),modal}function setTable(element,keyVar,compile,scope,modal){var table=element.find("table"),tr=$("<tr>").attr("ng-repeat",keyVar+" in model track by $index");tr.attr("ng-click","showModal('edit',"+keyVar+",$index)");for(var i=0;i<scope.columns.length;i++){var col=scope.columns[i],td=$("<td>");console.debug("subColumn.createdTd.col.row",col.row),/<[a-z][\s\S]*>/i.test(col.row)?$(col.row).appendTo(td):td.html(col.row),td.appendTo(tr),console.debug("subColumn.createdTd",td)}tr.appendTo(table),compile(table)(scope);var form=modal.find(".modal-content");form.attr("ng-submit","save(action,"+keyVar+")"),modal.on("hidden.bs.modal",function(e){scope.action=void 0});for(var modalBody=modal.find(".modal-body"),i=0;i<scope.columns.length;i++){var col=scope.columns[i];$(col.form).appendTo(modalBody)}compile(modal.contents())(scope)}function getSubTableModal(){return $("<div class='modal fade fluid-subtable-form' tabindex='-1' role='dialog'><div class='modal-dialog'><form class='modal-content' role='form'><div class='modal-header'><button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button> <h4 class='modal-title'>{{label}}</h4> </div> <div class='modal-body'> </div> <div class='modal-footer'> <div ng-switch='action'> <button type='submit' class='btn btn-info btn-lg create'>{{action == 'Edit' ? 'Update' :action }} </button> <button ng-if=\"action=='Edit'\" type='button' class='btn btn-danger btn-lg' ng-click='delete()'>Delete </button> <button type='button' class='btn btn-danger btn-lg' ng-click='hideModal()'>Cancel</button> </div> </div> </form> </div> </div>")}angular.module("fluid.webComponents.fluidCache",[]).service("fluidCache.service",["$templateCache",function(tc){return this.getCache=function(key){return tc.get(key)},this.putCache=function(key,data){tc.put(key,data),console.debug("fluidCache.service.put.key",key),console.debug("fluidCache.service.put.data",data)},this}]).factory("fluidCache.injector",["fluidCache.service",function(fs){return{response:function(response){return console.debug("fluidCache.injector.response",response),fs.getCache(response.config.url)===!1&&fs.putCache(response.config.url,response.data),response}}}]).directive("fluidCache",["fluidCache.service","$compile",function(fs){return{restrict:"A",link:function(scope,element,attr){element.ready(function(){var obj=scope.$$childHead.$eval(attr.fluidCache);console.debug("fluidCache.cache",obj),obj&&fs.putCache(obj,!1)})}}}]).config(["$httpProvider",function(hp){hp.interceptors.push("fluidCache.injector")}]),angular.module("fluid.webComponents.fluidLookup",[]).directive("fluidLookup",["$http","lookUp",function(h,lookUp){return{restrict:"A",link:function(scope,element,attr){var method="get";attr.method&&(method=attr.method),element.unbind("click"),element.bind("click",function(e){lookUp.open({event:e,method:method,values:attr.values,sourceUrl:attr.sourceUrl,label:attr.label,factory:attr.factory})})}}}]).directive("fluidLookupGrid",["$templateCache",function(tc){var fluidLookUpGrid={restrict:"AE",link:function(scope,element,attr){element.addClass("grid");var grid={};if(!attr.keyVar)throw"KeyVar attribute is required.";attr.lookupTemplate?grid.html=tc.get(attr.lookupTemplate):grid.html=element.html(),grid.keyVar=attr.keyVar,element.parent().attr("lookup-type","grid"),element.parent().attr("grid",JSON.stringify(grid)),element.remove()}};return fluidLookUpGrid}]).service("lookUp",["$compile","$http","$injector","$timeout",function(c,h,inj,t){this.open=function(options){var event=options.event,method=options.method,sourceUrl=options.sourceUrl,factory=options.factory,scope=angular.element($(event.currentTarget)).scope();scope.label=options.label;var source=$(event.currentTarget),modal=getModal(),loader=getLookupLoader(),oldHtml=$(event.currentTarget).html(),modalBody=modal.find(".modal-body");if(modalBody.addClass("fluid-lookup"),"grid"===source.attr("lookup-type")){var grid=JSON.parse(source.attr("grid")),selectorGrid=$("<div>").addClass("grid").attr("ng-repeat",grid.keyVar+" in data").appendTo(modalBody);selectorGrid.html(grid.html),source.attr("on-lookup")&&selectorGrid.attr("ng-click",source.attr("on-lookup"))}console.debug("lookupFactory.modalBody",modalBody.html()),c(modal)(scope),sourceUrl?($(event.currentTarget).html(loader),h({method:method,url:sourceUrl}).success(function(data){$(event.currentTarget).html(oldHtml),scope.data=data,modal.modal("show")})):factory&&t(function(){scope.data=inj.get(factory),console.debug("lookupFactory",scope.data),console.debug("lookupFactory.html",modal.html()),modal.modal("show")})}}]),angular.module("fluid.webComponents.fluidSelect",[]).directive("fluidSelect",["$templateCache","$http","$compile","$injector",function(tc,h,c,inj){return{scope:{model:"=",fieldGroup:"@",fieldValue:"@",fieldLabel:"@",change:"&",name:"@",method:"@"},restrict:"AE",replace:!0,template:tc.get("templates/fluid-select.html"),link:function(scope,element,attr){scope.loaded=!1,attr.label&&(scope.label=attr.label),scope.load=function(){attr.sourceUrl?(scope.isLoading=!0,h({method:scope.method,url:attr.sourceUrl}).success(function(sourceList){scope.sourceList=sourceList,scope.addElements(),c(dropDown.contents())(scope),scope.isLoading=!1,scope.loaded=!0})):attr.values?(scope.isLoading=!0,scope.sourceList=attr.values.split(","),scope.addElements(),c(dropDown.contents())(scope),scope.isLoading=!1,scope.loaded=!0):attr.factory&&(scope.isLoading=!0,scope.sourceList=inj.get(attr.factory),scope.addElements(),c(dropDown.contents())(scope),scope.isLoading=!1,scope.loaded=!0)},scope.method||(scope.method="GET"),!scope.name&&attr.label&&(scope.name=attr.label.trim().split(" ").join("_")),scope.options="item in sourceList",scope.fieldGroup&&(scope.options+="  | groupBy "+scope.fieldGroup);var itemLabel=scope.fieldLabel?"{{item."+scope.fieldLabel+"}}":"{{item}}",itemValue=scope.fieldValue?"item."+scope.fieldValue:"item",dropDown=element.find("ul.dropdown-menu"),label=element.find("span.label");label.attr("ng-if","model"),scope.fieldValue?label.attr("ng-repeat","item in sourceList | filter : {"+scope.fieldValue+": model} | limitTo: 1"):label.attr("ng-repeat","item in sourceList | filter : model | limitTo: 1"),label.html(itemLabel),c(label)(scope),scope.addElements=function(){var listElements=$("<li>").addClass("fluid-select-item").attr("ng-repeat",scope.options).appendTo(dropDown);$("<a>").attr("ng-click","select("+itemValue+",item,$index,$event)").addClass("morris-hover-point").text(itemLabel).appendTo(listElements)},scope.$watch(function(){return attr.sourceUrl},function(){scope.loaded=!1}),scope.$watch(function(){return attr.values},function(value){scope.loaded=!1}),scope.$watch(function(){return attr.factory},function(){scope.loaded=!1}),scope.select=function(item,full,$index,$event){scope.model=item,scope.change({item:item,full:full,$index:$index,$event:$event})},scope.$watch(function(scope){return scope.model},function(value){value&&(scope.loaded||scope.load())}),scope.look=function(){scope.loaded||scope.load()}}}}]),angular.module("fluid.webComponents.fluidSubcomponent",[]).directive("fluidSubcomponent",["fluidSubcomponent",function(fc){var fluidSubcomponent={restrict:"AE",replace:!0,collection:!0,link:function(scope,element,attr){if(!attr.tag)throw"Please define fluid web component tag [tag='']";var subComponent=$(fc.getSubcomponent(attr.tag).htmlTag);$.each(attr.$attr,function(k,v){"tag"===k||"fluidSubcomponent"===k||subComponent.attr(v,attr[k])}),element.replaceWith(subComponent[0]),element.addClass("fluid-subcomponent")}};return fluidSubcomponent}]).provider("fluidSubcomponent",function fluidSubcomponentProvider(){this.subcomponents=[],this.subcomponents["fluid-select"]={htmlTag:"<fluid-select>",events:["change"]},this.setSubcomponent=function(name,options){return this.subcomponents[name]=options,this},this.$get=[function(){var subcom=new fluidSubcomponentProvider;return subcom.getSubcomponent=function(name){return subcom.subcomponents[name]},subcom}]}),angular.module("fluid.webComponents.fluidSubTable",[]).directive("fluidSubtable",["$templateCache","$compile","lookUp",function(tc,c,lookUp){return{restrict:"AE",template:tc.get("templates/fluid-subtable.html"),transclude:!0,replace:!0,scope:{model:"=",validate:"&"},link:function(scope,element,attr){if(scope.columns=[],scope.method="get",attr.method&&(scope.method=attr.method),scope.model||(scope.model=[]),attr.sourceUrl&&(scope.sourceUrl=attr.sourceUrl),attr.label&&(scope.label=attr.label),!attr.keyVar)throw"KeyVar is required.";attr.factory&&(scope.factory=attr.factory),scope.selectItemFn="selectLookUp("+attr.keyVar+",$event)";var modal=getSubTableModal();modal.appendTo(element),scope.validate=function(value){return!0},console.debug("fluidSubtable.validate",scope.validate),scope.save=function(type,item){"Create"===type?item&&(scope.validate?scope.validate({value:item})&&(scope.model.push(item),scope.hideModal()):(scope.model.push(item),scope.hideModal()),console.debug("create.item",item)):"Edit"===type&&(scope.validate?scope.validate({value:item})&&(scope.model[scope.index]=item,scope.hideModal()):scope.hideModal())},scope.hideModal=function(){modal.modal("hide")},scope.showModal=function(action,item,$index){modal.modal("show"),"create"===action?(scope.action="Create",scope.item={}):"edit"===action&&(scope.action="Edit",scope.index=$index,scope.item={},angular.copy(scope.model[scope.index],scope.item))},scope.change=function(item,full,$index,$event){console.debug("fluidSubtable.event",$event),"Create"===item?(scope.action=item,scope.selectValue=void 0,modal.modal("show")):"Search"===item&&lookUp.open({method:scope.method,sourceUrl:scope.sourceUrl,event:$event,label:attr.label})},scope.select=function(item){scope.selectedItem=item},scope.selectLookUp=function(item,$event){scope.validate?scope.validate({value:item})&&scope.model.push(item):scope.model.push(item)},scope["delete"]=function(){scope.model.splice(scope.index,1),scope.hideModal()};var transclude=element.find("ng-transclude"),grid=$("<fluid-lookup-grid>").attr("key-var",attr.keyVar),gridContainer=$("<div>").addClass("fluid-grid").appendTo(grid);attr.lookupTemplate&&grid.attr("lookup-template",attr.lookupTemplate),transclude.find("fluid-subcolumn").each(function(){var column=JSON.parse($(this).attr("column"));$("<div>").html("{{item."+column.name+"}}").appendTo(gridContainer),scope.columns.push(column)}),console.debug("subTable.sourceUrl",scope.sourceUrl),console.debug("subTable.factory",scope.factory);var fluidLookup=element.find("button[fluid-lookup]");scope.sourceUrl||scope.factory?(grid.appendTo(fluidLookup),c(fluidLookup)(scope)):fluidLookup.addClass("hidden"),setTable(element,attr.keyVar,c,scope,modal),transclude.remove()}}}]).directive("fluidSubcolumn",["$compile",function(c){return{restrict:"AE",template:"<div ng-transclude></div>",link:{pre:function(scope,element,attr,controller,transcludeFn){},post:function(scope,element,attr){var column={};if(!attr.name)throw"Name attribute is required.";column.name=attr.name,attr.header&&(column.header=attr.header),attr.value&&(column.value=attr.value);var transclude=element.find("[ng-transclude]");column.row=transclude.find(".column-row").html();var form=transclude.find(".column-form").html();column.form=form,console.debug("fluidSubcolumn.column",column),element.attr("column",JSON.stringify(column))}},transclude:!0}}]),angular.module("fluid.webComponents.bootstrap",[]).directive("info",[function(){return{restrict:"A",link:function(scope,element){element.hasClass("fluid-select")?element.find(".dropdown-toggle").addClass("btn-info"):element.hasClass("btn")?element.addClass("btn-info"):element.hasClass("panel")?element.addClass("panel-info"):element.hasClass("fluid-subtable")&&(element.find(".panel").addClass("panel-info"),element.find(".modal.fluid-subtable-form").find(".modal-header").addClass("bg-info"))}}}]).directive("warning",[function(){return{restrict:"A",link:function(scope,element){element.hasClass("fluid-select")?element.find(".dropdown-toggle").addClass("btn-warning"):element.hasClass("btn")?element.addClass("btn-warning"):element.hasClass("panel")?element.addClass("panel-warning"):element.hasClass("fluid-subtable")&&(element.find(".panel").addClass("panel-warning"),element.find(".modal.fluid-subtable-form").find(".modal-header").addClass("bg-warning"))}}}]).directive("danger",[function(){return{restrict:"A",link:function(scope,element){element.hasClass("fluid-select")?element.find(".dropdown-toggle").addClass("btn-danger"):element.hasClass("btn")?element.addClass("btn-danger"):element.hasClass("panel")?element.addClass("panel-danger"):element.hasClass("fluid-subtable")?(element.find(".panel").addClass("panel-danger"),element.find(".modal.fluid-subtable-form").find(".modal-header").addClass("bg-danger")):element.hasClass("fluid-lookup")&&element.find(".modal").find(".modal-header").addClass("bg-danger")}}}]).directive("success",[function(){return{restrict:"A",link:function(scope,element){element.hasClass("fluid-select")?element.find(".dropdown-toggle").addClass("btn-success"):element.hasClass("btn")?element.addClass("btn-success"):element.hasClass("panel")?element.addClass("panel-success"):element.hasClass("fluid-subtable")&&element.find(".panel").addClass("panel-success")}}}]).directive("primary",[function(){return{restrict:"A",link:function(scope,element){element.hasClass("fluid-select")?element.find(".dropdown-toggle").addClass("btn-primary"):element.hasClass("btn")?element.addClass("btn-primary"):element.hasClass("panel")?element.addClass("panel-primary"):element.hasClass("fluid-subtable")?(element.find(".panel").addClass("panel-primary"),element.find(".modal.fluid-subtable-form").find(".modal-header").addClass("bg-primary")):element.hasClass("fluid-lookup")&&element.find(".modal").find(".modal-header").addClass("bg-primary")}}}]),angular.module("fluid.webComponents",["angular.filter","fluid.webComponents.fluidSubcomponent","fluid.webComponents.bootstrap","fluid.webComponents.fluidCache","fluid.webComponents.fluidSelect","fluid.webComponents.fluidSubTable","fluid.webComponents.fluidLookup","wcTemplates"]).directive("fluidDisabled",[function(){return{restrict:"A",link:function(scope,element,attr){scope.$watch(attr.fluidDisabled,function(disabled){disabled?(element.find("input").each(function(){$(this).attr("disabled","")}),element.find("button").each(function(){$(this).attr("disabled","")}),element.find("a").each(function(){$(this).attr("disabled","")})):(element.find("input").each(function(){$(this).removeAttr("disabled")}),element.find("button").each(function(){$(this).removeAttr("disabled")}),element.find("a").each(function(){$(this).removeAttr("disabled")}))})}}}]).controller("sampleCtrl",["$scope",function(scope){scope.change=function(item){console.debug("sampleCtrl.change",item)}}]).factory("samples",function(){return[{name:"rer",label:"wer"},{name:"3",label:"w"}]}),angular.module("wcTemplates",["templates/fluid-select.html","templates/fluid-subtable.html"]),angular.module("templates/fluid-select.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("templates/fluid-select.html",'<label class="control-label fluid-select">{{label}}<div class="btn-group fluid-select-dropdown"><button class="btn btn-lg dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" ng-click="look()" aria-expanded="false"><span class="label"></span> <span ng-if="!model">...</span> <span class="caret"></span></button><ul class="dropdown-menu"><li ng-if="isLoading"><a>Loading {{label ? label : \'selection\'}} <i class="fa fa-spinner fa-spin"></i></a></li></ul></div></label>')}]),angular.module("templates/fluid-subtable.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("templates/fluid-subtable.html",'<div class="fluid-subtable"><ng-transclude></ng-transclude><div class="panel"><div class="panel-heading"><span class="panel-title"><b>{{label}}</b></span><div class="panel-title pull-right"><button type="button" class="btn btn-lg btn-info" ng-click="showModal(\'create\')"><i class="fa fa-plus"></i></button> <button type="button" class="btn btn-lg btn-danger" ng-click="model=[]"><i class="fa fa-eraser"></i></button> <button source-url="{{sourceUrl}}" fluid-lookup type="button" class="btn btn-lg btn-warning" on-lookup="{{selectItemFn}}" method="{{method}}" label="{{label}}" factory="{{factory}}"><i class="fa fa-search"></i></button></div></div><table class="panel-body table table-striped table-condensed table-hover"><thead><th ng-repeat="col in columns">{{col.header}}</th></thead><tbody></tbody></table></div></div>')}]);